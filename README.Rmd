---
title: Visualizing Income Inequality in the United States
author: 7-Up- Blossom Mojekwu, Kartik Chamarti, Margaret Reed, Phillip Harmadi
output: github_document
---

```{r load-packages, include = FALSE}
library(tidyverse)
library(viridis)
library(ggrepel)
```

```{r load-data, include = FALSE}
income_mean <- read_csv(file = "data/income_mean.csv")
home_owner <- read_csv(file = "data/home_owner.csv")
race_wealth <- read_csv(file = "data/race_wealth.csv")
```

## Introduction

Our dataset comes from the Urban Institute and US Census and focuses on racial 
wealth inequality. We chose this dataset because wealth inequality is a very 
important issue in America, and it would be valuable to see the relationship 
between race and wealth over time in America. There are around 5-6 data files 
focused on the relationship between race and income over time. 

For the purpose of answering the two questions below, we will be focusing on the 
`home_owner` and `income_mean` data sets. The `home_owner` data set will help us 
to visualize home-ownership rate information for each race while the `income_mean` 
dataset will help us to visualize the income earned for each income quintile for 
each race during a particular time period.

## 1. How has home-ownership changed over time, and how does this trend vary between different races?

### Introduction

(1-2 paragraphs)
Introduction to the question and what parts of the dataset are necessary to answer the question. Also discuss why you’re interested in this question.

We first wanted to investigate how home ownership has changed over time, and 
among different racial groups. We decided to use the `home_owner` dataset and 
use the `year`, `race`, and `home_owner_pct` variables. 

### Approach

(1-2 paragraphs)
Describe what types of plots you are going to make to address your question.
For each plot, provide a clear explanation as to why this plot (e.g. boxplot, barplot, histogram, etc.) is best for providing the information you are asking about. 
The two plots should be of different types, and at least one of the two plots needs to use either color mapping or facets.

### Analysis

(2-3 code blocks, 2 figures, text/code comments as needed)
In this section, provide the code that generates your plots. Use scale functions to provide nice axis labels and guides.
You are welcome to use theme functions to customize the appearance of your plot, but you are not required to do so.
All plots must be made with ggplot2. Do not use base R or lattice plotting functions.


```{r find-peaks, include = F}
lowest_year <- home_owner %>%
  group_by(year) %>%
  summarize(mean_pct_unweighted = mean(home_owner_pct)) %>%
  arrange(mean_pct_unweighted) %>%
  slice(1) %>%
  pull(year)
highest_year <- home_owner %>%
  group_by(year) %>%
  summarize(mean_pct_unweighted = mean(home_owner_pct)) %>%
  arrange(desc(mean_pct_unweighted)) %>%
  slice(1) %>%
  pull(year)

last_year <- home_owner %>%
  group_by(race) %>%
  filter(year == max(year))
```

#### Plot 1.a

```{r first-look, echo = F}
home_owner %>%
  ggplot(
    aes(x = year, y = home_owner_pct, color = race, shape = race)
  ) +
  geom_line(size = 1) +
  geom_point(alpha = 0.5, size = 1.5) +
  geom_vline(aes(xintercept = lowest_year), color = "grey") +
  geom_vline(aes(xintercept = highest_year), color = "grey") +
  annotate(geom = "text",
    x = lowest_year - 5, 
    y = 0.56,
    label = paste0("Year with lowest \nhome ownership (", lowest_year, ")"),
    color = "black"
    ) +
  annotate(
    geom = "text",
    x = highest_year + 5, 
    y = 0.56, 
    label = paste0("Year with highest \nhome ownership (", highest_year, ")"), 
    color = "black"
    ) +
  geom_text_repel(data = last_year,
                  aes(label = race),
                  direction = "y",
                  nudge_x = 2,
                  nudge_y = 0.02,
                  size = 5,
                  segment.linetype = "dotted") +
  scale_color_manual(values = c("#859a6a", "#ad6e72", "#5d7a96")) +
  scale_y_continuous(labels = scales::percent_format(scale = 100)) +
  labs(
    x = "Year",
    y = "Percent owning homes",
    title = "Home ownership over time",
    subtitle = "by race",
    caption = "Source: U.S. Census 2019 Data"
  ) +
  theme_minimal() +
  theme(legend.position = "none")
```


#### Plot 1.b

```{r race-wealth, echo = F}
first_year <- race_wealth %>%
  filter(type == "Average",
         race != "Non-White",
         year > 1980) %>%
  group_by(race) %>%
  filter(year == min(year))

race_wealth %>%
  filter(type == "Average",
         race != "Non-White",
         year > 1980) %>%
  drop_na() %>%
  group_by(race, year) %>%
  ggplot(aes(x = year, y = wealth_family, color = race, shape = race)) +
  geom_point(alpha = 0.5, size = 1.5) +
  geom_line(size = 1) +
  geom_text_repel(data = first_year,
                  aes(label = race),
                  direction = "y",
                  nudge_y = 1000,
                  size = 3,
                  segment.linetype = "dotted") +
  geom_vline(aes(xintercept = lowest_year), color = "grey") +
  geom_vline(aes(xintercept = highest_year), color = "grey") +
  scale_color_manual(values = c("#859a6a", "#ad6e72", "#5d7a96")) +
  scale_y_continuous(labels = scales::label_number(big.mark = ",", 
                                                   scale = 0.001, 
                                                   suffix = "k",
                                                   prefix = "$")) +
  labs(
    x = "Year",
    y = "Average wealth per family",
    title = "Average wealth over time",
    subtitle = "by race",
    caption = "Source: U.S. Census 2019 Data"
  ) +
  theme_minimal() +
  theme(legend.position = "none")
```

### Discussion

(1-3 paragraphs)
In the Discussion section, interpret the results of your analysis. Identify any trends revealed (or not revealed) by the plots.
Speculate about why the data looks the way it does.

## 2. What does household income level look like for each racial group over time, and how do household income disparities compare among different racial groups?

### Introduction

Most income inequality research focuses on the income disparity between 
different races, for example, how Asian Americans and White Americans typically 
have higher income as compared to African Americans and Hispanic/Latino 
Americans. There is significantly less research focusing on the income 
disparities within each of the races. We are trying to figure out the degree of 
income inequality for each of the races within their own community.
In this question, we will be using `income_mean.csv`. This data set is 
sufficient since it provides us with the income information for each household 
quintile, year, and race. We will be using the following variables: `year`, 
`race`, `income_quintile`, and `income_dollars` which will be explained further 
in the "Approach" section.

### Approach

**Average income distribution by race has changed over time.** We chose a
***line plot*** and decided to facet by race with year on the x axis and average 
income amount on the y axis. We cared less about looking into specific years and 
more about overall trends and comparisons within each race. To clean the data 
for this visualization, we filtered out race categories that included 
combinations and the “all” category. This left us with 4 levels: Whites, Blacks, 
Hispanics, and Asians. We wanted to highlight the top earners in each racial 
category- so we colored them in red. Something interesting to note is that data 
collection for Asian observations only started around 2000. It is hard to easily 
compare differences between races, so we decided to zoom into 2019 and make a 
bar chart.

**Average income for each income quintile by race.** We chose a bar 
***bar graph*** because we are trying to compare how much more the top 20% of 
earners mae than those who make less for each racial group, and understand which 
race has the highest gap (through a stacked filled bar chart). A bar graph is 
ideal since we can group or stack them together and color them based on the 
income quintile variable, making the visualization easier to be understood by 
readers.

### Analysis

```{r data-wrangle-2, include = F}
income_mean <- income_mean %>%
  filter(
    !str_detect(race, "Combination"),
    !str_detect(race, "Not Hispanic"),
    !str_detect(race, "All"),
    dollar_type == "2019 Dollars",
    income_quintile != "Top 5%"
    ) %>%
  group_by(year, race, income_quintile) %>%
  summarize(income_dollars =  mean(income_dollars), .groups = "drop") %>%
  mutate(
    race = str_remove(race, ',?\\s(.*)'),
    income_percentile = case_when(
      income_quintile == "Top 5%"   ~ "1st - 5th",
      income_quintile == "Highest"  ~ "Top 20%",
      income_quintile == "Fourth"   ~ "21-40 %",
      income_quintile == "Middle"   ~ "41-60 %",
      income_quintile == "Second"   ~ "61-80 %",
      income_quintile == "Lowest"   ~ "Bottom 20%"),
    income_percentile = ordered(income_percentile, 
                                c("Bottom 20%", "61-80 %", "41-60 %", 
                                    "21-40 %", "Top 20%")),
    race = ordered(race, c("White", "Black", "Hispanic", "Asian")))
```

```{r perc-plot, include = F}
make_perc_table <- function(quintile) {
  return(
    income_mean %>%
      filter(year == 2019) %>%
      group_by(race) %>%
      transmute(income_quintile, 
                percent = income_dollars / sum(income_dollars)) %>%
      filter(income_quintile == quintile)
  )
}

highest_perc_table <- make_perc_table("Highest")
perc_21_40_perc_table <- make_perc_table("Fourth")
perc_41_60_perc_table <- make_perc_table("Middle")
perc_61_80_perc_table <- make_perc_table("Second")
bottom_perc_table <- make_perc_table("Lowest")
```

#### Plot 2.a

```{r plot-overtime, echo = F}
income_mean %>%
  ggplot(
    aes(
      x = year, 
      y = income_dollars, 
      color = income_percentile
      )
  ) +
  geom_line() +
  facet_wrap(. ~ race, nrow = 1) +
  scale_y_continuous(labels = scales::label_number(big.mark = ",", 
                                                   scale = 0.001, 
                                                   suffix = "k",
                                                   prefix = "$")) +
  scale_color_manual(values = c("grey40", "grey50", "grey60", "grey70", 
                                "firebrick2")) +
  labs(
    title = "Income Gap: How does income distribution compare for each race?",
    subtitle = "per income quintile in time series",
    x = "Year", 
    y = "Mean household income", 
    color = "Income quintile",
    caption = "Source: U.S. Census 2019 Data"
    ) +
  theme_minimal() +
  theme(
    legend.position = "bottom",
    axis.text.x.bottom = element_text(angle = 90)
    ) +
  guides(color = guide_legend(reverse = TRUE))
```

#### Plot 2.b

```{r plot-bar, echo = F}
income_mean %>%
  filter(year == 2019) %>%
  ggplot(
    aes(x = income_dollars, y = reorder(race, desc(race)))
    ) + 
  geom_bar(
    position = "fill", 
    stat = "identity", 
    aes(fill = income_percentile),
    width = 0.7
    ) +
  geom_text(
    data = highest_perc_table, 
    aes(y = race, label = paste0(round(percent, 3) * 100)),
    x = 0.45, 
    size = 2.5,
    color = "black",
    nudge_y = -0.45
    ) +
  geom_text(
    data = perc_21_40_perc_table, 
    aes(y = race, label = paste0(round(percent, 3) * 100)),
    x = 0.65, 
    size = 2.5,
    color = "black",
    nudge_y = -0.45
    ) +
  geom_text(
    data = perc_41_60_perc_table, 
    aes(y = race, label = paste0(round(percent, 3) * 100)),
    x = 0.80, 
    size = 2.5,
    color = "black",
    nudge_y = -0.45
    ) +
  geom_text(
    data = perc_61_80_perc_table, 
    aes(y = race, label = paste0(round(percent, 3) * 100)),
    x = 0.92, 
    size = 2.5,
    color = "black",
    nudge_y = -0.45
    ) +
  geom_text(
    data = bottom_perc_table, 
    aes(y = race, label = paste0(round(percent, 3) * 100)),
    x = 0.975, 
    size = 2.5,
    color = "black",
    nudge_y = -0.45
    ) +
  scale_fill_brewer(type = "seq", palette = "Blues", direction = -1) +
  labs(
    title = "Income Gap: How much do top quintile households earn compared to other quintiles?",
    subtitle = "Proportion of income earned for each household quintile per race in 2019",
    x = "Percentage %", 
    y = "Race", 
    fill = "Income Quintile",
    caption = "Source: U.S. Census 2019 Data"
    ) +
  scale_colour_viridis_d() +
  scale_x_continuous(
    labels = scales::label_number(
      big.mark = ",", 
      scale = 100, 
      suffix = "", 
      prefix = ""
      ),
    breaks = seq(-0.2, 1.2, 0.2)
    ) +
  guides(fill = guide_legend(reverse = TRUE)) +
  theme_minimal(base_size = 10) +
  theme(
    text = element_text(size = 9),
    axis.title.x = element_text(vjust = -2),
    plot.caption = element_text(vjust = -3, hjust = 0))
```

### Discussion

From the 1st plot, we found that those who are Asian tended to have the highest 
average income, and their top 20% made far more than the other racial groups. 
Overtime, income disparities in all the racial categories increased when 
considering the top 20% of income earners. This increase in disparity seemed to 
be most noticeable for White households. We suspect that generally income is the 
highest among Asians due to their high educational attainment on average, and 
lowest in Black individuals due to the systemic disadvantages they have 
experienced throughout U.S. history.

From the 2nd plot, we can roughly surmise that income inequality is the highest 
within Black households and lowest within Hispanic households. Our speculation 
is that income inequality is highest among the Black category on average, 
because of lack of high-paying jobs and opportunities for Black individuals 
living in the rural Southern States vs. those living in Northeastern or 
Midwestern urban areas. For Asians, we speculate that income inequality is 
higher than Hispanics due to the different migration patterns and sources that 
Asian Americans' ancestors came from. For example, Indian and Chinese Americans 
have a high proportion of professional college-educated citizens, while a lot of 
Southeast Asian Americans are doing blue-collared jobs and many came to the 
United States as refugees from less wealthy backgrounds. 

## Presentation

Our presentation can be found [here](presentation/presentation.html).

## Data 

Include a citation for your data here. 
See http://libraryguides.vu.edu.au/c.php?g=386501&p=4347840 for guidance on proper citation for datasets. 
If you got your data off the web, make sure to note the retrieval date.

## References

List any references here. You should, at a minimum, list your data source.

Our data comes from the [Urban Institute](https://apps.urban.org/features/wealth-inequality-charts/) 
and the [US Census](https://www.census.gov/data/tables/time-series/demo/income-poverty/historical-income-households.html). 

The US Census provides [Historical Income Tables](https://www.census.gov/data/tables/time-series/demo/income-poverty/historical-income-households.html), of which we have joined several to compare wealth and income over time by 
race.

